(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{4:function(e,t){e.exports={GLOBAL_CHAT:"GLOBAL_CHAT",USER_CONNECTED:"USER_CONNECTED",MESSAGE_RECIEVED:"MESSAGE_RECIEVED",MESSAGE_SENT:"MESSAGE_SENT",USER_DISCONNECTED:"USER_DISCONNECTED",TYPING:"TYPING",VERIFY_USER:"VERIFY_USER",LOGOUT:"LOGOUT",PRIVATE_MESSAGE:"PRIVATE_MESSAGE",NEW_CHAT_USER:"NEW_CHAT_USER"}},47:function(e,t,a){var n=a(81);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.filter(function(e){return e!==t}).filter(function(e,t,a){return a.indexOf(e)===t}).join(", ")}var r=function(e){return"".concat(e.getHours(),":").concat(("0"+e.getMinutes()).slice(-2))};e.exports={createMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,a=void 0===t?"":t,s=e.sender,c=void 0===s?"":s;return{id:n(),time:r(new Date(Date.now())),message:a,sender:c}},createChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.messages,a=void 0===t?[]:t,r=(e.name,e.users),c=void 0===r?[]:r,i=e.isGlobal,o=void 0!==i&&i;return{id:n(),name:o?"Home":s(c),messages:a,users:c,typingUsers:[],isGlobal:o}},createUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=void 0===t?"":t,s=e.socketId,r=void 0===s?null:s;return{id:n(),name:a,socketId:r}},createChatNameFromUsers:s}},50:function(e,t,a){e.exports=a(90)},78:function(e,t){},88:function(e,t,a){},90:function(e,t,a){"use strict";a.r(t);var n=a(2),s=a.n(n),r=a(14),c=a.n(r),i=a(6),o=a(7),l=a(10),u=a(8),m=a(9),d=a(46),h=a.n(d),p=a(21),v=a(4),E=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).setUser=function(e){var t=e.isUser,n=e.user;t?a.setError("Username taken"):(a.setError(null),a.props.setUser(n))},a.handleSubmit=function(e){e.preventDefault(),a.props.socket.emit(v.VERIFY_USER,a.state.handle,a.setUser)},a.handleChange=function(e){a.setState({handle:e.target.value})},a.setError=function(e){a.setState({error:e})},a.state={handle:"",error:""},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.handle,n=t.error;return s.a.createElement("div",{className:"login"},s.a.createElement("form",{onSubmit:this.handleSubmit,className:"login-form"},s.a.createElement("div",{className:"logo"},"iChaty"),s.a.createElement("input",{placeholder:"Your handle...",autoFocus:!0,ref:function(t){e.textInput=t},type:"text",id:"nickname",value:a,onChange:this.handleChange}),s.a.createElement("button",{type:"submit",className:"enter-btn"},s.a.createElement(p.a,null)),s.a.createElement("div",{className:"error"},n||null)))}}]),t}(n.Component),f=a(49),g=a(31),S=a(11),C=a(12),b=a(13),y=a(30),O=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,a=e.lastMessage,n=e.active,r=e.onClick;return t?s.a.createElement("div",{className:"user ".concat(n?"active":""),onClick:r},s.a.createElement("div",{className:"user-photo"},t[0].toUpperCase()),s.a.createElement("div",{className:"user-info"},s.a.createElement("div",{className:"name"},t),a&&s.a.createElement("div",{className:"last-message"},a))):null}}]),t}(n.Component),N=a(47),k=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.onSendPrivateMessage(a.state.reciever),a.setState({reciever:""})},a.addChatForUser=function(e){a.props.onSendPrivateMessage(e),a.setActiveSidebar(t.type.CHATS)},a.setActiveSidebar=function(e){a.setState({activeSidebar:e})},a.toggleNavbar=a.toggleNavbar.bind(Object(b.a)(Object(b.a)(a))),a.state={collapsed:a.props.width<767,reciever:"",activeSidebar:t.type.CHATS},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"toggleNavbar",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"render",value:function(){var e=this,a=this.props,n=a.user,r=a.users,c=a.setActiveChat,i=a.logout,o=a.chats,l=a.activeChat,u=a.width,m=this.state,d=m.reciever,h=m.activeSidebar,v=Object(C.uniqBy)(o,"id");return s.a.createElement("div",{id:"side-bar"},s.a.createElement(S.f,{color:"faded",light:!0},s.a.createElement(S.g,{className:"mr-auto"},"iChaty"),s.a.createElement("div",{className:"current-chat-nav"},this.props.activeChat?this.props.activeChat.name:null),s.a.createElement(S.h,{onClick:this.toggleNavbar,className:"mr-2"}),s.a.createElement(S.b,{isOpen:!this.state.collapsed,navbar:!0},s.a.createElement(S.d,{navbar:!0,vertical:!0},s.a.createElement(S.e,null,s.a.createElement("form",{onSubmit:this.handleSubmit,className:"search"},s.a.createElement("i",{className:"search-icon"},s.a.createElement(p.b,null)),s.a.createElement("input",{onChange:function(t){return e.setState({reciever:t.target.value})},value:d,placeholder:"Search",type:"text"}))),s.a.createElement(S.e,null,s.a.createElement("div",{className:"side-bar-select"},s.a.createElement("div",{onClick:function(){return e.setActiveSidebar(t.type.CHATS)},className:"side-bar-select__option ".concat(h===t.type.CHATS?"active":"")},s.a.createElement("span",null,"Chats")),s.a.createElement("div",{onClick:function(){return e.setActiveSidebar(t.type.USERS)},className:"side-bar-select__option ".concat(h===t.type.USERS?"active":"")},s.a.createElement("span",null,"Users")))),s.a.createElement(S.e,{className:"userList"},s.a.createElement("div",{className:"users",ref:"users",onClick:function(t){t.target===e.refs.user&&c(null)}},h===t.type.CHATS?v.map(function(t,a,r){return s.a.createElement(O,{key:t.id,lastMessage:Object(C.get)(Object(C.last)(t.messages),"message",""),name:t.isGlobal?t.name:Object(N.createChatNameFromUsers)(t.users,n.name),active:l.id===t.id,onClick:function(){return e.props.setActiveChat(t),u<767?e.setState({collapsed:!e.state.collapsed}):null}})}):Object(C.differenceBy)(r,[n],"name").map(function(t){return s.a.createElement(O,{key:t.id,name:t.name,onClick:function(){return e.addChatForUser(t.name),u<767?e.setState({collapsed:!e.state.collapsed}):null}})}))),s.a.createElement(S.e,{className:"small"},s.a.createElement("div",{className:"current-user"},s.a.createElement("span",null,n.name),s.a.createElement("div",{onClick:function(){i()},title:"Logout",className:"logout"},s.a.createElement(y.a,null))))))),s.a.createElement("div",{className:"current-user big"},s.a.createElement("span",null,n.name),s.a.createElement("div",{onClick:function(){i()},title:"Logout",className:"logout"},s.a.createElement(y.a,null))))}}]),t}(n.Component);k.type={CHATS:"chats",USERS:"users"};var T=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).scrollDown=a.scrollDown.bind(Object(b.a)(Object(b.a)(a))),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.scrollDown()}},{key:"componentDidUpdate",value:function(e,t){this.scrollDown()}},{key:"scrollDown",value:function(){var e=this.refs.container;e.scrollTop=e.scrollHeight}},{key:"render",value:function(){var e=this.props,t=e.messages,a=e.user,n=e.typingUsers,r=Object(C.uniqBy)(t,"id");return s.a.createElement("div",{ref:"container",className:"thread-container"},s.a.createElement("div",{className:"thread"},r.map(function(e){return s.a.createElement("div",{key:e.id,className:"message-container ".concat(e.sender===a.name&&"right")},s.a.createElement("div",{className:"time"},s.a.createElement("span",null,e.sender.slice(0,1).toUpperCase())),s.a.createElement("div",{className:"data"},s.a.createElement("div",{className:"message"},e.message),s.a.createElement("div",{className:"name"},e.time)))}),s.a.createElement("div",{className:"typing-user"},n.map(function(e){return s.a.createElement("span",{key:"typing_user"+Date.now()},"".concat(e," is typing..."))}))))}}]),t}(n.Component),U=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.sendMessage(),a.setState({message:""})},a.sendMessage=function(){a.props.sendMessage(a.state.message)},a.sendTyping=function(){a.lastUpdateTime=Date.now(),a.state.isTyping||(a.setState({isTyping:!0}),a.props.sendTyping(!0),a.startCheckingTyping())},a.startCheckingTyping=function(){a.typingInterval=setInterval(function(){Date.now()-a.lastUpdateTime>300&&(a.setState({isTyping:!1}),a.stopCheckingTyping())},300)},a.stopCheckingTyping=function(){a.typingInterval&&(clearInterval(a.typingInterval),a.props.sendTyping(!1))},a.state={message:"",isTyping:!1},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.stopCheckingTyping()}},{key:"render",value:function(){var e=this,t=this.state.message;return s.a.createElement("div",{className:"message-input"},s.a.createElement("form",{onSubmit:this.handleSubmit,className:"message-form"},s.a.createElement("input",{type:"text",id:"message",ref:"messageInput",className:"form-control",value:t,placeholder:"Message",onKeyUp:function(t){return 13!==t.keyCode&&e.sendTyping()},onChange:function(t){var a=t.target.value;e.setState({message:a})}}),s.a.createElement("button",{disabled:t.length<1,type:"submit",className:"send"},"Send")))}}]),t}(n.Component),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).sendOpenPrivateMessage=function(e){a.props.socket.emit(v.PRIVATE_MESSAGE,{reciever:e,sender:a.props.user.name,activeChat:a.state.activeChat})},a.addUserToChat=function(e){var t=e.chatId,n=e.newUser,s=a.state.chats.map(function(e){return e.id===t?Object.assign({},e,{users:Object(g.a)(e.users).concat([n])}):e});a.setState({chats:s})},a.removeUsersFromChat=function(e){var t=a.state.chats.map(function(t){var a=Object(C.difference)(t.users,e.map(function(e){return e.name}));return Object(f.a)({},t,{users:a})});a.setState({chats:t})},a.resetChat=function(e){return a.addChat(e,!0)},a.addChat=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?[e]:Object(g.a)(a.state.chats).concat([e]);a.setState({chats:t,activeChat:e});var n="".concat(v.MESSAGE_RECIEVED,"-").concat(e.id),s="".concat(v.TYPING,"-").concat(e.id);a.props.socket.on(s,a.updateTypingInChat(e.id)),a.props.socket.on(n,a.addMessageToChat(e.id))},a.updateTypingInChat=function(e){return function(t){var n=t.isTyping,s=t.user;if(s!==a.props.user.name){var r=a.state.chats.map(function(t){return t.id===e&&(n&&!t.typingUsers.includes(s)?t.typingUsers.push(s):!n&&t.typingUsers.includes(s)&&(t.typingUsers=t.typingUsers.filter(function(e){return e!==s}))),t});a.setState({chats:r})}}},a.sendMessage=function(e,t){a.props.socket.emit(v.MESSAGE_SENT,{chatId:e,message:t})},a.sendTyping=function(e,t){a.props.socket.emit(v.TYPING,{chatId:e,isTyping:t})},a.setActiveChat=function(e){a.setState({activeChat:e})},a.state={chats:[],users:[],activeChat:null,width:Math.max(document.documentElement.clientWidth,window.innerWidth||0)},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(t){e.setState({width:Math.max(document.documentElement.clientWidth,window.innerWidth||0)})}),this.props.socket.emit(v.GLOBAL_CHAT,this.resetChat),this.initSocket(this.props.socket)}},{key:"componentWillUnmount",value:function(){this.props.socket.off(v.PRIVATE_MESSAGE),this.props.socket.off(v.USER_CONNECTED),this.props.socket.off(v.USER_DISCONNECTED),this.props.socket.off(v.NEW_CHAT_USER)}},{key:"initSocket",value:function(e){var t=this;e.on(v.PRIVATE_MESSAGE,this.addChat),e.on("connect",function(){e.emit(v.GLOBAL_CHAT,t.resetChat)}),e.on(v.USER_CONNECTED,function(e){t.setState({users:Object(C.values)(e)})}),e.on(v.USER_DISCONNECTED,function(e){var a=Object(C.differenceBy)(t.state.users,Object(C.values)(e));t.removeUsersFromChat(a),t.setState({users:Object(C.values)(e)})}),e.on(v.NEW_CHAT_USER,this.addUserToChat)}},{key:"addMessageToChat",value:function(e){var t=this;return function(a){var n=t.state.chats.map(function(t){return t.id===e&&t.messages.push(a),t});t.setState({chats:n})}}},{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.logout,r=this.state,c=r.chats,i=r.activeChat,o=r.users,l=r.width;return s.a.createElement(S.c,null,s.a.createElement(S.i,null,s.a.createElement(S.a,{md:"3"},s.a.createElement(k,{name:i?i.name:"Hiu",logout:n,chats:c,user:a,users:o,activeChat:i,width:l,setActiveChat:this.setActiveChat,onSendPrivateMessage:this.sendOpenPrivateMessage})),s.a.createElement(S.a,{md:"9"},s.a.createElement("div",{className:"chat-room-container"},null!==i?s.a.createElement("div",{className:"chat-room"},s.a.createElement(T,{messages:i.messages,user:a,typingUsers:i.typingUsers}),s.a.createElement(U,{sendMessage:function(t){return e.sendMessage(i.id,t)},sendTyping:function(t){return e.sendTyping(i.id,t)}})):s.a.createElement("div",{className:"chat-room choose"},s.a.createElement("h3",null,"Choose a chat!"))))))}}]),t}(n.Component),A="/",_=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).reconnect=function(e){e.emit(v.VERIFY_USER,a.state.user.name,function(e){var t=e.isUser,n=e.user;t?a.state({user:null}):a.setUser(n)})},a.initSocket=function(){var e=h()(A);e.on("connect",function(){return a.state.user&&a.reconnect(e),null}),a.setState({socket:e})},a.setUser=function(e){a.state.socket.emit(v.USER_CONNECTED,e),a.setState({user:e})},a.logout=function(){a.state.socket.emit(v.LOGOUT),a.setState({user:null})},a.state={socket:null,user:null},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){this.initSocket()}},{key:"render",value:function(){var e=this.state,t=e.socket,a=e.user;return s.a.createElement("div",{className:"layout"},a?s.a.createElement(j,{socket:t,user:a,logout:this.logout}):s.a.createElement(E,{socket:this.state.socket,setUser:this.setUser}))}}]),t}(n.Component),w=(a(86),a(88),function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(_,{title:"Chat App"})}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[50,2,1]]]);
//# sourceMappingURL=main.b22293cf.chunk.js.map